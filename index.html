<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>å¤§å‡‰å›½äº‘é€šä¿¡ - ç™»å½•</title>
<meta name="theme-color" content="#004bbb">
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,"Noto Sans",sans-serif;background:#f4f4f9}h1{text-align:center}section{max-width:360px;margin:20vh auto 0;background:#fff;padding:32px;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,.1)}input{width:100%;padding:10px;margin:8px 0;box-sizing:border-box;border:1px solid #ccc;border-radius:4px}button{width:100%;padding:10px;border:none;border-radius:4px;background:#004bbb;color:#fff;font-size:16px;cursor:pointer}button:disabled{background:#aaa}.tip{color:#666;font-size:14px;text-align:center;margin-top:8px}
</style>
</head>
<body>
<section>
  <h1>ğŸ“ å¤§å‡‰å›½äº‘é€šä¿¡</h1>
  <input id="name" placeholder="ç”¨æˆ·åï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰">
  <input id="pwd" type="password" placeholder="å¯†ç " onkeydown="if(event.key==='Enter')handleLogin()">
  <button onclick="handleRegister()">æ³¨å†Œå¹¶ç™»å½•</button>
  <button onclick="handleLogin()">ç™»å½•</button>
  <div class="tip">æ³¨å†Œå³è¡¨ç¤ºåŒæ„ã€Šå¤§å‡‰å›½ç¦»çº¿éšç§æ”¿ç­–ã€‹</div>
</section>
<script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
<script>
function getUsers(){try{return JSON.parse(localStorage.getItem('dl_users')||'{}')}catch{localStorage.removeItem('dl_users');return{}}}
function hash(pwd){return CryptoJS.SHA256(pwd).toString()}
function handleRegister(){
  const name=document.getElementById('name').value.trim().toLowerCase();
  const pwd=document.getElementById('pwd').value.trim();
  if(!name||!pwd)return alert('è¯·è¾“å…¥å®Œæ•´');
  if(!/^[a-z0-9_\u4e00-\u9fa5]{2,16}$/.test(name))return alert('ç”¨æˆ·å 2-16 ä½ï¼Œä»…æ”¯æŒå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ä¸­æ–‡');
  const users=getUsers();
  if(users[name])return alert('ç”¨æˆ·å·²å­˜åœ¨');
  users[name]={pwd:hash(pwd),groups:[]};
  localStorage.setItem('dl_users',JSON.stringify(users));
  loginSuccess(name);
}
function handleLogin(){
  const name=document.getElementById('name').value.trim().toLowerCase();
  const pwd=document.getElementById('pwd').value.trim();
  const users=getUsers();
  if(!users[name]||users[name].pwd!==hash(pwd))return alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
  loginSuccess(name);
}
function loginSuccess(name){
  localStorage.setItem('dl_currentUser',name);
  location.href='./app.html';
}
</script>
</body>
</html>
